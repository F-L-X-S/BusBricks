\doxysection{Service\+Interface.\+h}
\hypertarget{_service_interface_8h_source}{}\label{_service_interface_8h_source}\index{/Users/felixschulke/Developement/Arduino/Modbus\_RTU/Modbus\_RTU/Modbus-\/RTU/lib/Interface/ServiceInterface.h@{/Users/felixschulke/Developement/Arduino/Modbus\_RTU/Modbus\_RTU/Modbus-\/RTU/lib/Interface/ServiceInterface.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ SERVICEINTERFACE\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ SERVICEINTERFACE\_H}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#ifdef\ ARDUINO}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\ \ \ \ \#include\ <Arduino.h>}\ \ \ \ \textcolor{comment}{//\ include\ Arduino-\/Library\ for\ platformIO-\/build\ }}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\ \ \ \ \#include\ <mockArduino.h>}}
\DoxyCodeLine{00007\ \ \ \ \ \textcolor{keyword}{using\ namespace\ }arduinoMocking;}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <CommInterface.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <ServiceCluster.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <Frame.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <Content\_stack.h>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ STACKSIZE\ 2\ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Size\ of\ Send-\/\ /\ Rec-\/Stack}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ DEBUG}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{comment}{//\ Template\ for\ generic\ Service-\/Interface}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ The\ derived\ class\ defines\ the\ handling\ of\ incoming\ frames\ from\ communication-\/interface\ to\ the\ services\ (associated\ by\ service-\/id)}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ and\ the\ conversion\ from\ PDU\ provided\ by\ Services\ to\ frames\ getting\ sent\ by\ the\ communication-\/interface}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ Template-\/parameters:\ }}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ \ -\/type\ of\ the\ Communication-\/Interface\ (e.g.\ SoftwareSerial,\ Wire...)}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ \ -\/type\ of\ the\ frames\ to\ be\ send\ as\ a\ derived\ Class\ of\ the\ Frame-\/Class\ (e.g.\ Frame\_modbusRTU)}}
\DoxyCodeLine{00025\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ CommInterfaceBase,\ \textcolor{keyword}{typename}\ frameType>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_service_interface}{ServiceInterface}}\{}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Constructor\ for\ Service-\/Interface\ }}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_service_interface}{ServiceInterface}}(\mbox{\hyperlink{class_comm_interface_base}{CommInterfaceBase}}*\ comm\_interface,\ \mbox{\hyperlink{class_service_cluster_base}{ServiceClusterBase}}*\ services):}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm\_interface(comm\_interface),\ }
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ services(services)\ \{\};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Execute\ all\ relevant\ tasks\ for\ transferring\ data\ between\ CommInterface\ and\ Services:}}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/\ Get\ PDU\ from\ Services}}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/\ Add\ PDU\ to\ Services}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/\ Update\ communication-\/stacks}}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/\ Execute\ the\ CommInterfaces\ Comm-\/cycle\ }}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Has\ to\ be\ implemented\ in\ the\ derived\ class}}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ communicate()\ =\ 0;\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_comm_interface_base}{CommInterfaceBase}}*\ comm\_interface;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Communication-\/Interface\ }}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_service_cluster_base}{ServiceClusterBase}}*\ services;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ServiceCluster\ containing\ the\ Services\ associated\ with\ the\ Interface\ }}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_content__stack}{Content\_stack<frameType,\ STACKSIZE>}}\ recStack;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ stack\ for\ received\ frames}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_content__stack}{Content\_stack<frameType,\ STACKSIZE>}}\ sendStack;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ stack\ for\ frames\ to\ send\ next}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ String\ sendItem;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Item\ to\ be\ sent\ next}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ String\ recItem;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Item\ received\ last}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ all\ PDUs\ provided\ by\ the\ services\ to\ the\ sendstack}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Implemented\ in\ derived\ Class,\ depending\ on\ frametype}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ getPDU\_from\_services()=0;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impart\ all\ received\ PDUs\ from\ the\ receivestack\ to\ the\ associated\ services\ }}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Implemented\ in\ derived\ Class,\ depending\ on\ frametype}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ addPDU\_to\_services()=0;}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ start\ the\ processing\ of\ the\ registered\ services\ }}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ processServices()\{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ services-\/>getNumberOfServices();\ i++)}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_service_base}{ServiceBase}}*\ destinationService\ =\ services-\/>getService\_byPos(i);\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pointer\ to\ the\ destination-\/Service\ }}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destinationService-\/>stackProcessing();}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ the\ last\ item\ from\ the\ sendstack\ to\ the\ Comminterface}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ delete\ it\ after\ sending}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ processSendStack()\{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Serial\ debugging}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Processing\ Send-\/Stack..."{}});}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Handle\ sendstack}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!sendStack.empty())}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (comm\_interface-\/>finishedSending())\{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_frame}{Frame}}*\ frameToSend\ =\ sendStack.getElement();\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ next\ item\ from\ the\ send-\/stack}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendItem\ =\ frameToSend-\/>getFrame();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ Frame\ from\ Item}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ String*\ sendItemAdr\ =\ \&sendItem;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm\_interface-\/>sendNewFrame(sendItemAdr);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impart\ Frame\ that\ has\ to\ be\ sent\ next\ }}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendStack.deleteElement();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ delete\ Item\ from\ send-\/stack}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm\_interface-\/>sendCycle();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ execute\ sending\ }}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \};\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ items\ received\ by\ the\ CommInterface\ to\ the\ Receivestack}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ processRecStack()\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Serial\ debugging}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Processing\ Receive-\/Stack..."{}});}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#endif\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Handle\ receivebuffer\ }}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (comm\_interface-\/>receivedNewFrame()\ \&\&\ !recStack.full())\{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (recItem\ !=\ \textcolor{stringliteral}{"{}"{}})\{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Item\ not\ empty\ }}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ frameString\ frameStr\ =\ recItem.c\_str();\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ conversion\ for\ identification\ as\ framestring\ in\ Frame-\/Class-\/Constructor}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ frameType\ recItemFrame(\&frameStr);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Construct\ Frame-\/Class\ derived\ Object}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recStack.addElement(recItemFrame);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ the\ received\ element\ to\ the\ stack}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ recItem\ =\ \textcolor{stringliteral}{"{}"{}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ rec-\/Item\ }}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm\_interface-\/>getReceivedFrame(\&recItem);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Impart\ memory\ the\ received\ item\ has\ to\ be\ stored\ at\ }}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ comm\_interface-\/>receiveCycle();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Receive\ new\ frames\ from\ comm-\/interface\ }}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ comm\_interface-\/>receiveCycle();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Receive\ new\ frames\ from\ comm-\/interface}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00108\ \};}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ SERVICEINTERFACE\_H}}

\end{DoxyCode}
