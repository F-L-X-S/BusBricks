\doxysection{Comm\+Interface.\+h}
\hypertarget{_comm_interface_8h_source}{}\label{_comm_interface_8h_source}\index{/Users/felixschulke/Developement/Arduino/Modbus\_RTU/Modbus\_RTU/Modbus-\/RTU/lib/Interface/CommInterface.h@{/Users/felixschulke/Developement/Arduino/Modbus\_RTU/Modbus\_RTU/Modbus-\/RTU/lib/Interface/CommInterface.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ COMMINTERFACE\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ COMMINTERFACE\_H}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#ifdef\ ARDUINO}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\ \ \ \ \#include\ <Arduino.h>}\ \ \ \ \textcolor{comment}{//\ include\ Arduino-\/Library\ for\ platformIO-\/build\ }}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\ \ \ \ \#include\ <mockArduino.h>}}
\DoxyCodeLine{00007\ \ \ \ \ \textcolor{keyword}{using\ namespace\ }arduinoMocking;}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include<Frame.h>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Communcation-\/Interface-\/Base-\/Class\ }}
\DoxyCodeLine{00013\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_comm_interface_base}{CommInterfaceBase}}}
\DoxyCodeLine{00014\ \{}
\DoxyCodeLine{00015\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{comment}{//\ Setup\ the\ Interface,\ has\ to\ be\ called\ in\ Setup-\/function}}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keywordtype}{void}\ setup\_interface()\{\};}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{comment}{//\ Add\ a\ new\ Frame\ to\ the\ send-\/buffer}}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordtype}{void}\ sendNewFrame(String*\ sendFrame)\{\};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{comment}{//\ Check,\ if\ the\ Frame\ was\ sent\ and\ the\ CommInterface\ is\ ready\ to\ send\ the\ next\ Frame\ }}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{bool}\ finishedSending()\{\};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{//\ Define\ the\ destination,\ the\ next\ received\ Frame\ should\ be\ copied\ to\ }}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{void}\ getReceivedFrame(String*\ destFrameBuffer)\{\};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{//\ Check,\ if\ a\ new\ Frame\ was\ received\ }}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{bool}\ receivedNewFrame()\{\};}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{comment}{//\ Execute\ the\ Communication-\/Cycle}}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordtype}{void}\ execCommunicationCycle()\{\};}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{class_comm_interface_base}{CommInterfaceBase}}(\textcolor{comment}{/*\ args\ */})\{\};}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{class_comm_interface_base}{\string~CommInterfaceBase}}()\{\};}
\DoxyCodeLine{00036\ \};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{comment}{//\ Template\ for\ generic\ communication-\/interface}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ specifies\ a\ standardized\ interface\ to\ use\ for\ integrating\ }}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ any\ hardware-\/interface\ (e.g.\ SoftwareSerial,\ OneWire...)into\ a\ Service\ Interface\ }}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ The\ template\ ensures\ the\ correct\ handling\ of\ send-\/\ and\ receive-\/buffers\ of\ the\ interface:}}
\DoxyCodeLine{00043\ \textcolor{comment}{//}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ sendBuffer\ set\ to\ nullptr:\ \ \ \ \ \ \ the\ Interface\ is\ ready\ to\ send\ another\ frame}}
\DoxyCodeLine{00045\ \textcolor{comment}{//\ sendBuffer\ not\ set\ to\ nullptr:\ \ \ the\ frame,\ sendBuffer\ is\ pointing\ to,\ has\ to\ be\ send\ next\ }}
\DoxyCodeLine{00046\ \textcolor{comment}{//}}
\DoxyCodeLine{00047\ \textcolor{comment}{//\ recBuffer\ set\ to\ nullptr:\ \ \ \ \ \ \ \ the\ frame\ received\ last\ was\ written\ to\ the\ destination\ successfully,\ no\ new\ receive-\/Buffer\ was\ defined}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ recBuffer\ not\ set\ to\ nullptr:\ \ \ \ the\ interface\ is\ waiting\ to\ receive\ a\ new\ frame\ to\ write\ ist\ to\ the\ destination,\ recBuffer\ is\ pointing\ to\ }}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ \textcolor{keywordtype}{int}erface\_type>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00051\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_comm_interface}{CommInterface}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_comm_interface_base}{CommInterfaceBase}}\{}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ interface\_type*\ interface;}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ String*\ sendBuffer\ =\ \textcolor{keyword}{nullptr};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ to\ nullptr\ if\ Frame\ was\ sent\ }}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ String*\ receiveBuffer\ =\ \textcolor{keyword}{nullptr};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ to\ nullptr\ if\ Frame\ was\ copied\ to\ destination}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ a\ Frame\ }}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ True,\ if\ a\ frame\ was\ send\ successfully\ }}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ send()\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ implementation\ of\ sending\ a\ Frame\ has\ to\ be\ done\ in\ the\ derived\ class}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Receive\ a\ Frame\ }}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ True,\ if\ a\ new\ Frame\ was\ received}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ receive()\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ implementation\ of\ receiving\ a\ Frame\ has\ to\ be\ done\ in\ the\ derived\ class}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Construct\ Communication-\/Interface\ }}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_comm_interface}{CommInterface}}(interface\_type*\ interface,\ uint32\_t\ baudrate):\ interface(interface)\{\};\ }
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ a\ new\ Frame\ to\ the\ send-\/buffer}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ sendNewFrame(String*\ sendFrame)\{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sendBuffer\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer\ =\ sendFrame;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ the\ send-\/buffer-\/ptr\ to\ the\ Frame,\ that\ has\ to\ be\ sent\ }}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check,\ if\ the\ Frame\ was\ sent\ and\ the\ CommInterface\ is\ ready\ to\ send\ the\ next\ Frame\ }}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ finishedSending()\{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sendBuffer==\textcolor{keyword}{nullptr};}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Define\ the\ destination,\ the\ next\ received\ Frame\ should\ be\ copied\ to\ }}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ getReceivedFrame(String*\ destFrameBuffer)\{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ receiveBuffer\ =\ destFrameBuffer;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ the\ receive-\/buffer-\/ptr\ to\ the\ destination,\ the\ next\ received\ Frame\ should\ be\ stored\ at\ }}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check,\ if\ a\ new\ Frame\ was\ received\ }}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ receivedNewFrame()\{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ receiveBuffer==\textcolor{keyword}{nullptr};}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Execution\ of\ receive-\/cycle}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ receiveCycle()\{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Receiving}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (receive())\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ receiveBuffer\ =\ \textcolor{keyword}{nullptr};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ the\ receive-\/buffer\ to\ nullptr\ after\ a\ new\ frame\ was\ received\ }}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Execution\ of\ send-\/cycle}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ sendCycle()\{\ \ \ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sending}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (send())\{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sendBuffer\ =\ \textcolor{keyword}{nullptr};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ the\ send-\/buffer\ to\ nullptr\ after\ the\ frame,\ pointed\ to,\ was\ send\ }}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \};\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00108\ \};}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ COMMINTERFACE\_H}}

\end{DoxyCode}
